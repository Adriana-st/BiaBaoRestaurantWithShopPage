<style>
    body {
        background-color: #000;
        color: #fff;
        padding-top: 100px;
    }
    
    .product-card {
        background-color: #1a1a1a;
        border: 2px solid #333;
        transition: all 0.3s ease;
        height: 100%;
    }
    
    .product-card:hover {
        transform: translateY(-5px);
        border-color: #FFC107;
        box-shadow: 0 10px 30px rgba(255, 193, 7, 0.3);
    }
    
    .product-image {
        height: 250px;
        object-fit: cover;
        width: 100%;
    }
    
    .add-to-cart-btn {
        transition: all 0.3s ease;
    }
    
    .add-to-cart-btn:hover {
        transform: scale(1.05);
    }

    .loading-spinner {
        border: 4px solid #333;
        border-top: 4px solid #FFC107;
        border-radius: 50%;
        width: 50px;
        height: 50px;
        animation: spin 1s linear infinite;
        margin: 50px auto;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
</style>

<main>
    <!-- Page Header -->
    <section class="container my-5">
        <div class="text-center mb-5">
            <h1 class="display-3 fw-bold text-warning mb-3">Order Online</h1>
            <p class="lead text-light">Choose your favourite dishes and order for delivery or pickup</p>
        </div>
    </section>

    <!-- Loading Indicator -->
    <div id="loadingIndicator" class="text-center">
        <div class="loading-spinner"></div>
        <p class="text-light mt-3">Loading products...</p>
    </div>

    <!-- Product Grid -->
    <section class="container mb-5">
        <div class="row g-4" id="productGrid">
            <!-- Products will be loaded here dynamically from JSON -->
        </div>
    </section>

    <!-- Cart Summary Sticky Bottom -->
    <div class="position-fixed bottom-0 start-0 end-0 bg-dark border-top border-warning p-3 d-none" 
         id="cartSummary" 
         style="z-index: 999;">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h5 class="text-warning mb-0">
                        <span id="cartItemCount">0</span> items in cart - 
                        Total: €<span id="cartTotal">0.00</span>
                    </h5>
                </div>
                <div class="col-md-4 text-end">
                    <a href="/cart" class="btn btn-warning btn-lg fw-bold">
                        View Cart & Checkout
                    </a>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- Cart Management Script - Loading Products from JSON -->
<script>
    // Load products from JSON file
    async function loadProducts() {
        try {
            const response = await fetch('/data/products.json');
            const data = await response.json();
            
            // Hide loading indicator
            document.getElementById('loadingIndicator').style.display = 'none';
            
            // Display products
            displayProducts(data.products);
            
        } catch (error) {
            console.error('Error loading products:', error);
            document.getElementById('loadingIndicator').innerHTML = `
                <div class="alert alert-danger">
                    <strong>Error!</strong> Could not load products. Please refresh the page.
                </div>
            `;
        }
    }

    // Display products in grid
    function displayProducts(products) {
        const productGrid = document.getElementById('productGrid');
        
        products.forEach(product => {
            // Only show available products
            if (!product.available) return;
            
            const productCard = `
                <div class="col-12 col-sm-6 col-lg-4 col-xl-3">
                    <div class="card product-card">
                        <img src="/${product.image}" 
                             class="card-img-top product-image" 
                             alt="${product.name}"
                             onerror="this.src='/images/placeholder.jpg'">
                        <div class="card-body d-flex flex-column">
                            <h5 class="card-title text-warning fw-bold">${product.name}</h5>
                            <p class="card-text text-light flex-grow-1">
                                ${product.description}
                            </p>
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <span class="fs-4 fw-bold text-warning">€${product.price.toFixed(2)}</span>
                                <div class="input-group" style="width: 100px;">
                                    <button class="btn btn-outline-warning btn-sm" 
                                            type="button" 
                                            onclick="changeQuantity(this, -1)">-</button>
                                    <input type="number" 
                                           class="form-control form-control-sm text-center" 
                                           value="1" 
                                           min="1" 
                                           max="10" 
                                           readonly>
                                    <button class="btn btn-outline-warning btn-sm" 
                                            type="button" 
                                            onclick="changeQuantity(this, 1)">+</button>
                                </div>
                            </div>
                            <button class="btn btn-warning w-100 fw-bold add-to-cart-btn" 
                                    onclick='addToCart(${JSON.stringify(product)}, this)'>
                                Add to Cart
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            productGrid.innerHTML += productCard;
        });
    }

    // Change quantity
    function changeQuantity(button, change) {
        const input = button.parentElement.querySelector('input');
        let value = parseInt(input.value) + change;
        if (value < 1) value = 1;
        if (value > 10) value = 10;
        input.value = value;
    }

    // Add to cart function (compatible with sample code pattern)
    function addToCart(product, button) {
        // Get quantity
        const quantityInput = button.closest('.card-body').querySelector('input');
        const quantity = parseInt(quantityInput.value);
        
        // Get cart from localStorage
        let cart = JSON.parse(localStorage.getItem('cart')) || [];
        
        // Check if item already exists
        const existingItem = cart.find(item => item.id === product.id);
        
        if (existingItem) {
            existingItem.quantity += quantity;
        } else {
            cart.push({
                id: product.id,
                name: product.name,
                price: product.price,
                image: product.image,
                quantity: quantity
            });
        }
        
        // Save to localStorage
        localStorage.setItem('cart', JSON.stringify(cart));
        
        // Update checkout counter (like sample code)
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        localStorage.setItem('checkout', totalItems);
        
        // Show feedback
        showAddedToCartFeedback(button);
        
        // Update displays
        updateCartDisplay();
        
        // Dispatch custom event for nav counter
        window.dispatchEvent(new Event('cartUpdated'));
        
        // Reset quantity to 1
        quantityInput.value = 1;
    }

    // Show feedback when item added
    function showAddedToCartFeedback(button) {
        const originalText = button.innerHTML;
        button.innerHTML = '✓ Added!';
        button.classList.remove('btn-warning');
        button.classList.add('btn-success');
        button.disabled = true;
        
        setTimeout(() => {
            button.innerHTML = originalText;
            button.classList.remove('btn-success');
            button.classList.add('btn-warning');
            button.disabled = false;
        }, 1500);
    }

    // Update cart display
    function updateCartDisplay() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        const totalPrice = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
        
        const cartSummary = document.getElementById('cartSummary');
        const cartItemCount = document.getElementById('cartItemCount');
        const cartTotal = document.getElementById('cartTotal');
        
        if (totalItems > 0) {
            cartSummary.classList.remove('d-none');
            cartItemCount.textContent = totalItems;
            cartTotal.textContent = totalPrice.toFixed(2);
        } else {
            cartSummary.classList.add('d-none');
        }
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', () => {
        loadProducts();
        updateCartDisplay();
    });
</script>
